<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>openssh - itw&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Mr Wen" /><meta name="description" content="" /><meta name="keywords" content="Linux, Github, Network, Cloud, Python" />






<meta name="generator" content="Hugo 0.55.4 with even 4.0.0" />


<link rel="canonical" href="https://itwhs.github.io/post/openssh/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.c2a46f00.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/reset-even.css">


<meta property="og:title" content="openssh" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itwhs.github.io/post/openssh/" />
<meta property="article:published_time" content="2018-09-29T16:15:57&#43;08:00"/>
<meta property="article:modified_time" content="2018-09-29T16:15:57&#43;08:00"/>

<meta itemprop="name" content="openssh">
<meta itemprop="description" content="">


<meta itemprop="datePublished" content="2018-09-29T16:15:57&#43;08:00" />
<meta itemprop="dateModified" content="2018-09-29T16:15:57&#43;08:00" />
<meta itemprop="wordCount" content="3473">



<meta itemprop="keywords" content="ssh," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="openssh"/>
<meta name="twitter:description" content=""/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">itw</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于我</li>
      </a><a href="https://github.com/itwhs/">
        <li class="mobile-menu-item">GitHub</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">itw</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于我</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://github.com/itwhs/">GitHub</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">openssh</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-09-29 16:15 </span>
        <div class="post-category">
            <a href="/categories/linux%E8%BF%90%E7%BB%B4/"> Linux运维 </a>
            </div>
          <span class="more-meta"> 约 3473 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-使用-ssh-访问远程命令行">1. 使用 SSH 访问远程命令行</a>
<ul>
<li>
<ul>
<li><a href="#1-1-openssh-简介">1.1 OpenSSH 简介</a></li>
<li><a href="#1-2-ssh-版本">1.2 SSH 版本</a></li>
<li><a href="#1-3-ssh-认证方式">1.3 SSH 认证方式</a></li>
<li><a href="#1-4-openssh-的工作模式">1.4 openSSH 的工作模式</a></li>
<li><a href="#1-4-secure-shell-示例">1.4 Secure Shell 示例</a></li>
<li><a href="#1-5-ssh-主机密钥">1.5 SSH 主机密钥</a></li>
</ul></li>
</ul></li>
<li><a href="#2-配置基于-ssh-密钥的身份验证">2. 配置基于 SSH 密钥的身份验证</a></li>
<li><a href="#3-自定义-ssh-服务配置">3. 自定义 SSH 服务配置</a></li>
<li><a href="#4-ssh-安全注意事项">4. SSH 安全注意事项</a></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="1-使用-ssh-访问远程命令行">1. 使用 SSH 访问远程命令行</h1>

<h3 id="1-1-openssh-简介">1.1 OpenSSH 简介</h3>

<p><code>OpenSSH</code>这一术语指系统中使用的<code>Secure Shell</code>软件的软件实施。用于在远程系统上安全运行<code>shell</code>。如果您在可提供<code>ssh</code>服务的远程<code>Linux</code>系统中拥有用户帐户，则<code>ssh</code>是通常用来远程登录到该系统的命令。ssh命令也可用于在远程系统中运行命令。</p>

<p>常见的远程登录工具有：</p>

<ul>
<li>telnet</li>
<li>ssh</li>
<li>dropbear</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></pre></td>
<td class="lntd">
<pre class="chroma">telnet      //远程登录协议，23/TCP
    认证明文
    数据传输明文
(由于其不安全性,现如今使用telnet远程登录的比较少了,一般用这个命令来测试端口是否开启)

ssh         //Secure SHell，应用层协议，22/TCP
    通信过程及认证过程是加密的，主机认证
    用户认证过程加密
    数据传输过程加密
   (相对较安全,不容易被破解)
    
dropbear    //嵌入式系统专用的SSH服务器端和客户端工具</pre></td></tr></table>
</div>
</div>
<h3 id="1-2-ssh-版本">1.2 SSH 版本</h3>

<p><code>openssh</code>有两个版本，分别为v1和v2，其特点如下：</p>

<blockquote>
<p>v1：基于CRC-32做MAC，无法防范中间人（man-in-middle）攻击</p>

<p>v2：双方主机协议选择安全的MAC方式。基于DH算法做密钥交换，基于RSA或DSA算法实现身份认证</p>
</blockquote>

<h3 id="1-3-ssh-认证方式">1.3 SSH 认证方式</h3>

<p><code>openssh</code>有两种认证方式，分别是：</p>

<ul class="task-list">
<li>基于口令认证:输入用户名和密码</li>

<li><p>基于密钥认证</p>

<ul class="task-list">
<li><label><input type="checkbox" disabled class="task-list-item"> 客户端建立两把钥匙(公钥与私钥)</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> 将公钥数据上传到服务器上</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> 将公钥放置服务器端的正确目录与文件名（scp 或 ssh-copy-id）</label></li>
</ul></li>
</ul>

<p><img src="../../img/ssh1.png" alt="ssh1" /></p>

<h3 id="1-4-openssh-的工作模式">1.4 openSSH 的工作模式</h3>

<p><strong><code>openSSH</code>是基于C/S架构工作的。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></pre></td>
<td class="lntd">
<pre class="chroma">服务器端    //sshd，配置文件在/etc/ssh/sshd_config

客户端     //ssh，配置文件在/etc/ssh/ssh_config
    ssh-keygen      //密钥生成器
    ssh-copy-id     //将公钥传输至远程服务器
    scp             //跨主机安全复制工具</pre></td></tr></table>
</div>
</div>
<h3 id="1-4-secure-shell-示例">1.4 Secure Shell 示例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></pre></td>
<td class="lntd">
<pre class="chroma">以当前用户身份创建远程交互式shell，然后在结束时使用exit命令返回到之前的shell
[D:\~]$ ssh ec2-user@13.231.194.216
Password: 
Last login: Mon Apr  1 07:55:44 UTC 2019 on pts/0
[root@ip-10-0-10-33 ~]# exit
logout
[ec2-user@ip-10-0-10-33 ~]$

以其他用户身份（remoteuser）在选定主机（remotehost）上连接到远程`shell`
[root@ip-10-0-10-33 ~]# ssh wenhs@13.231.194.216
wenhs@13.231.194.216&#39;s password:
[wenhs@ip-10-0-10-33 ~]$ exit
logout
Connection to 10.0.10.33 closed.

以远程用户身份（remoteuser）在远程主机（remotehost）上通过将输出返回到本地显示器的方式来执行单一命令
[root@ip-10-0-10-33 ~]# ip a s eth0
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 06:56:68:17:b8:b4 brd ff:ff:ff:ff:ff:ff
    inet 10.0.10.33/24 brd 10.0.10.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::456:68ff:fe17:b8b4/64 scope link 
       valid_lft forever preferred_lft forever
[root@ip-10-0-10-33 ~]# ssh ec2-user@13.231.194.216 &#39;/usr/sbin/ip a s ens33&#39;
ec2-user@13.231.194.216&#39;s password:
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 06:56:68:17:b8:b4 brd ff:ff:ff:ff:ff:ff
    inet 10.0.10.33/24 brd 10.0.10.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::456:68ff:fe17:b8b4/64 scope link 
       valid_lft forever preferred_lft forever
       
w命令可以显示当前登录到计算机的用户列表。这对于显示哪些用户使用ssh从哪些远程位置进行了登录以及执行了何种操作等内容特别有用
[root@ip-10-0-10-33 ~]# w
 16:46:39 up  1:02,  3 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
root     :0       :0               15:44   ?xdm?  59.79s  0.25s /usr/libexec/gnome-ses
root     pts/0    :0               15:45    1.00s  0.15s  0.01s w
root     pts/3    ym-wenhs-pc-d4b1 16:31   21.00s  0.04s  0.04s -bash</pre></td></tr></table>
</div>
</div>
<h3 id="1-5-ssh-主机密钥">1.5 SSH 主机密钥</h3>

<p><code>ssh</code>通过公钥加密的方式保持通信安全。当某一ssh客户端连接到ssh服务器时，在该客户端登录之前，服务器会向其发送公钥副本。这可用于为通信渠道设置安全加密，并可验证客户端的服务器。</p>

<p>当用户第一次使用<code>ssh</code>连接到特定服务器时，<code>ssh</code>命令可在用户的<code>~/.ssh/known_hosts</code>文件中存储该服务器的公钥。在此之后每当用户进行连接时，客户端都会通过对比<code>~/.ssh/known_hosts</code>文件中的服务器条目和服务器发送的公钥，确保从服务器获得相同的公钥。如果公钥不匹配，客户端会假定网络通信已遭劫持或服务器已被入侵，并且中断连接。</p>

<p>这意味着，如果服务器的公钥发生更改（由于硬盘出现故障导致公钥丢失，或者出于某些正当理由替换公钥），用户则需要更新其<code>~/.ssh/known_hosts</code>文件并删除旧的条目才能够进行登录。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></pre></td>
<td class="lntd">
<pre class="chroma">主机ID存储在本地客户端系统上的 ~/.ssh/known_hosts 中
[root@ip-10-0-10-33 ~]# cat ~/.ssh/known_hosts 
|1|8rW60XdgmpybvWPLSWEQcnZGDpM=|lc4gt9vvnAXZdb44tQszjQz5pGs= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAJ9X6VwmkCjY9IVN6m0qJOJt1WkXdbF/urbikUSm0g0rWHOYaMoAkDVzirHFgK7BKDzqLDe/v8gIZcysmUBt+o=
|1|PtGqIyYZtZx2jTb3cNeqKNWJz+E=|43R/vnypv9OEmwnPzm1Yoj4dz5U= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAJ9X6VwmkCjY9IVN6m0qJOJt1WkXdbF/urbikUSm0g0rWHOYaMoAkDVzirHFgK7BKDzqLDe/v8gIZcysmUBt+o=

主机密钥存储在SSH服务器上的 /etc/ssh/ssh_host_key* 中
[root@ip-10-0-10-33 ~]# ls /etc/ssh/*key*
/etc/ssh/ssh_host_dsa_key
/etc/ssh/ssh_host_dsa_key.pub
/etc/ssh/ssh_host_ecdsa_key
/etc/ssh/ssh_host_ecdsa_key.pub
/etc/ssh/ssh_host_ed25519_key
/etc/ssh/ssh_host_ed25519_key.pub
/etc/ssh/ssh_host_rsa_key
/etc/ssh/ssh_host_rsa_key.pub</pre></td></tr></table>
</div>
</div>
<h1 id="2-配置基于-ssh-密钥的身份验证">2. 配置基于 SSH 密钥的身份验证</h1>

<p>用户可通过使用公钥身份验证进行<code>ssh</code>登录身份验证。<code>ssh</code>允许用户使用私钥-公钥方案进行身份验证。这意味着将生成私钥和公钥这两个密钥。私钥文件用作身份验证凭据，像密码一样，必须妥善保管。公钥复制到用户希望登录的系统，用于验证私钥。公钥并不需要保密。拥有公钥的ssh服务器可以发布仅持有您私钥的系统才可解答的问题。因此，可以根据所持有的密钥进行验证。如此一来，就不必在每次访问系统时键入密码，但安全性仍能得到保证。</p>

<p><strong>使用<code>ssh-keygen</code>命令生成密码。将会生成私钥<code>~/.ssh/id_rsa</code>和公钥<code>~/.ssh/id_rsa.pub</code>。</strong></p>

<p><strong><em>注意：</em></strong></p>

<blockquote>
<p>生成密钥时，系统将提供指定密码的选项，在访问私钥时必须提供该密码。如果私钥被偷，除颁发者之外的其他任何人很难使用该私钥，因为已使用密码对其进行保护。这样，在攻击者破解并使用私钥前，会有足够的时间生成新的密钥对并删除所有涉及旧密钥的内容。</p>
</blockquote>

<p>生成<code>ssh</code>密钥后，密钥将默认存储在家目录下的<code>.ssh/</code>目录中。私钥和公钥的权限就分别为<code>600</code>和<code>644</code>。<code>.ssh</code>目录权限必须是<code>700</code>。</p>

<p>在可以使用基于密钥的身份验证前，需要将公钥复制到目标系统上。可以使用<code>ssh-copy-id</code>完成这一操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">[root@ip-10-0-10-33 ~]# ssh-copy-id remoteuser@remotehost</pre></td></tr></table>
</div>
</div>
<p>通过<code>ssh-copy-id</code>将密钥复制到另一系统时，它默认复制<code>~/.ssh/id_rsa.pub</code>文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></pre></td>
<td class="lntd">
<pre class="chroma">SSH密钥演示
使用 ssh-keygen 创建公钥-私钥对
[root@ip-10-0-10-33 ~]# ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:QTqn8+Ml2UR0cRlD/PlOhcX3xoqIUQH/tM8OfM7G9t8 root@ip-10-0-10-33
The key&#39;s randomart image is:
+---[RSA 2048]----+
|        o.o.o+=+ |
|       o o.. .o.+|
|      o o.o .  =+|
|       +.o o ...*|
|      o So..o. oo|
|       o.+...o. o|
|        = o o.+o |
|       . +   *+ o|
|        .    o+.E|
+----[SHA256]-----+

使用 ssh-copy-id 将公钥复制到远程系统上的正确位置
[root@wenhs5479 ~]# ls ~/.ssh/
id_rsa  id_rsa.pub
[root@wenhs5479 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.88
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &#34;/root/.ssh/id_rsa.pub&#34;
The authenticity of host &#39;192.168.42.88 (192.168.42.88)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:qwQZf/VtSahPu/kpd9GE2x3GUPwRqgnJc4SEotVRwdQ.
ECDSA key fingerprint is MD5:0d:a1:e4:e8:03:ad:0b:32:c2:1f:bd:f1:4f:a6:84:9c.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@192.168.42.88&#39;s password:

Number of key(s) added: 1

Now try logging into the machine, with:   &#34;ssh &#39;root@192.168.42.88&#39;&#34;
and check to make sure that only the key(s) you wanted were added.

使用 ssh 命令无命令登录远程主机
[root@wenhs5479 ~]# ssh root@192.168.42.88
Last login: Mon Apr  1 17:59:03 2019 from ym-wenhs-pc-c311
[root@wenhs5479 ~]# ip a s ens32
2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:8a:2a:2e brd ff:ff:ff:ff:ff:ff
    inet 192.168.42.88/24 brd 192.168.42.255 scope global noprefixroute dynamic ens32
       valid_lft 2080sec preferred_lft 2080sec
    inet6 fe80::ed8d:7e09:d472:34a5/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
       
       
使用 scp 命令传送文件到远程主机
[root@wenhs5479 ~]# scp test.sh root@192.168.42.88:/tmp
root@192.168.42.88&#39;s password:
test.sh                                                       100%   45    29.8KB/s   00:00

使用 scp 命令从远程主机上下载文件到本地
[root@wenhs5479 ~]# ls
anaconda-ks.cfg  test.sh
[root@wenhs5479 ~]# rm -f test.sh
[root@wenhs5479 ~]# ls
anaconda-ks.cfg  
[root@wenhs5479 ~]# scp root@192.168.42.88:/tmp/test.sh .
root@192.168.42.88&#39;s password:
test.sh                                                       100%   45    39.1KB/s   00:00
[root@wenhs5479 ~]# ls
anaconda-ks.cfg    test.sh

scp命令常用选项
    -r      //递归复制
    -p      //保持权限
    -P      //端口
    -q      //静默模式
    -a      //全部复制</pre></td></tr></table>
</div>
</div>
<h1 id="3-自定义-ssh-服务配置">3. 自定义 SSH 服务配置</h1>

<p>虽然<code>OpenSSH</code>服务器通常无需修改，但会提供其他安全措施，可以在配置文件<code>/etc/ssh/sshd_config</code>中修改<code>OpenSSH</code>服务器的各个方面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></pre></td>
<td class="lntd">
<pre class="chroma">PermitRootLogin {yes|no}    //是否允许root用户远程登录系统
PermitRootLogin without-password    //仅允许root用户基于密钥方式远程登录
PasswordAuthentication {yes|no}     //是否启用密码身份验证，默认开启</pre></td></tr></table>
</div>
</div>
<h1 id="4-ssh-安全注意事项">4. SSH 安全注意事项</h1>

<ul>
<li>密码应该经常换且足够复杂</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></pre></td>
<td class="lntd">
<pre class="chroma">[root@wenhs5479 ~]# tr -dc A-Za-z0-9_ &lt; /dev/urandom | head -c 30 |xargs
Ic6TRUmCqafpaUoZcqDiWBiEWphTvk

[root@wenhs5479 ~]# openssl rand 20 -base64
GcGX26V2/rrwMy9+5SOgPkVnspA=   //生成20位随机密码</pre></td></tr></table>
</div>
</div>
<ul class="task-list">
<li>使用非默认端口</li>
<li>限制登录客户端地址</li>
<li>仅监听特定的IP地址</li>
<li>禁止管理员直接登录</li>
<li>仅允许有限制用户登录

<ul class="task-list">
<li><label><input type="checkbox" disabled class="task-list-item"> AllowUsers</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> AllowGroups</label></li>
</ul></li>
<li>使用基于密钥的认证</li>
<li>禁止使用空密码</li>
<li>禁止使用SSHv1版本</li>
<li>设定空闲会话超时时长</li>
<li>利用防火墙设置ssh访问策略</li>
<li>限制ssh的访问频度和并发在线数</li>
<li>做好日志的备份，经常分析（集中于某台服务器）</li>
</ul>

<p><strong>实验</strong></p>

<p><strong>1.说明密钥认证的过程</strong></p>

<p><img src="../../img/ssh2.jpg" alt="ssh2" />*</p>

<ul>
<li>Client端向Server端发起SSH连接请求。</li>
<li>Server端向Client端发起版本协商。</li>
<li>协商结束后Server端发送Host Key公钥 Server Key公钥，随机数等信息。到这里所有通信是不加密的。</li>
<li>Client端返回确认信息，同时附带用公钥加密过的一个随机数，用于双方计算Session Key。</li>
<li>进入认证阶段。从此以后所有通信均加密。</li>
<li>认证成功后，进入交互阶段。</li>
</ul>

<p><strong>2.手动配置密钥认证登录</strong></p>

<p><strong>生成密钥对</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">$ ssh-keygen</pre></td></tr></table>
</div>
</div>
<p>此处可选择生成密钥的文件路径，默认为~/.ssh/id_rsa
密码为可选。</p>

<p><strong>拷贝公钥到服务器</strong></p>

<p>方式一：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">$ ssh-copy-id -i ~/.ssh/id_rsa.pub xxx@host</pre></td></tr></table>
</div>
</div>
<p>方式二：</p>

<p>手动拷贝id_rsa.pub到服务器上，并收到添加认证文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">$ cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</pre></td></tr></table>
</div>
</div>
<p><strong>服务器配置</strong></p>

<p>配置服务器上/etc/ssh/sshd_config文件，修改以下配置项</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></pre></td>
<td class="lntd">
<pre class="chroma">RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile  .ssh/authorized_keys
修改后，重启sshd服务，根据不同的系统使用相应命令</pre></td></tr></table>
</div>
</div>
<p><strong>登录</strong></p>

<p>直接登录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">$ ssh user@host</pre></td></tr></table>
</div>
</div>
<p>如果配置成功，则不需要密码直接登录。</p>

<p><strong>问题</strong></p>

<p>配置成功后，仍提示密码输入
主要原因在于服务器上认证文件及所在目录的权限问题
详情排查步骤可查看文章配置ssh公钥登录提示还是输入密码</p>

<p><strong>解决方法：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">$ chmod 755 ~/home/xxxuser</pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Mr Wen</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2018-09-29 16:15
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a target="_blank" rel="license noopener" href="https://github.com/itwhs/itwhs.github.io/blob/master/LICENSE">MIT</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/img/reward/wechat.png">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/img/reward/alipay.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/ssh/">ssh</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/ftp/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">FTP</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/">
            <span class="next-text nav-default">计划任务</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:itwhs@foxmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://blog.csdn.net/wenhs5479" class="iconfont icon-cnblogs" title="cnblogs"></a>
      <a href="https://github.com/itwhs" class="iconfont icon-github" title="github"></a>
  <a href="https://itwhs.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2018 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Mr Wen</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139425163-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
